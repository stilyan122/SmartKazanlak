@using SmartKazanlak.Core.Models.EventRequest
@model IEnumerable<EventRequestListDto>
@{
    ViewData["Title"] = "Моите заявки";
}

<style>
    :root {
        --blue: #0b5ed7;
        --yellow: #fcd251;
        --ink: #0b1b34;
        --muted: rgba(11,27,52,.72);
        --border: rgba(0,0,0,.10);
        --shadow: 0 12px 30px rgba(0,0,0,.08);
        --radius: 18px;
    }

    .pg-wrap {
        padding: 30px 0;
    }

    .pg-head {
        display: flex;
        align-items: flex-end;
        justify-content: space-between;
        gap: 12px;
        flex-wrap: wrap;
        margin-bottom: 14px;
    }

    .pg-title {
        margin: 0;
        font-weight: 950;
        letter-spacing: -0.02em;
        color: var(--ink);
        font-size: 26px;
    }

    .pg-sub {
        margin: 0;
        color: var(--muted);
        font-size: 14px;
    }

    .pg-btn {
        border-radius: 14px;
        padding: 12px 14px;
        font-weight: 950;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        border: 1px solid rgba(13,110,253,.18);
        background: rgba(13,110,253,.06);
        color: var(--blue);
    }

        .pg-btn:hover {
            box-shadow: 0 0 0 4px rgba(13,110,253,.10);
        }

    .pg-list {
        display: grid;
        gap: 12px;
    }

    .pg-item {
        border: 1px solid var(--border);
        border-radius: var(--radius);
        background: #fff;
        box-shadow: var(--shadow);
        padding: 16px;
        display: grid;
        gap: 12px;
    }

    .pg-row {
        display: flex;
        justify-content: space-between;
        gap: 12px;
        align-items: flex-start;
        flex-wrap: wrap;
    }

    .pg-name {
        margin: 0;
        font-weight: 950;
        color: var(--ink);
        letter-spacing: -0.02em;
        font-size: 16px;
    }

    .pg-meta {
        color: var(--muted);
        font-size: 13px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .pg-pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid rgba(0,0,0,.10);
        background: rgba(0,0,0,.03);
        font-weight: 900;
        font-size: 12px;
        color: rgba(11,27,52,.78);
    }

    /* status badges */
    .pg-status {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        border-radius: 999px;
        font-weight: 950;
        font-size: 12px;
        border: 1px solid rgba(0,0,0,.10);
    }

    .pg-status--new {
        background: rgba(13,110,253,.08);
        border-color: rgba(13,110,253,.22);
        color: #0b4fb9;
    }

    .pg-status--approved {
        background: rgba(25,135,84,.10);
        border-color: rgba(25,135,84,.25);
        color: #146c43;
    }

    .pg-status--rejected {
        background: rgba(220,53,69,.10);
        border-color: rgba(220,53,69,.25);
        color: #b02a37;
    }

    .pg-grid2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }

    .pg-kv {
        border: 1px solid rgba(0,0,0,.08);
        background: rgba(0,0,0,.02);
        border-radius: 16px;
        padding: 12px 12px;
        display: grid;
        gap: 4px;
    }

    .pg-k {
        font-size: 12px;
        font-weight: 950;
        color: rgba(11,27,52,.62);
        letter-spacing: .01em;
    }

    .pg-v {
        font-size: 14px;
        color: var(--ink);
        font-weight: 850;
        line-height: 1.35;
        word-break: break-word;
    }

    .pg-note {
        border: 1px dashed rgba(255,193,7,.35);
        background: rgba(252,210,81,.14);
        border-radius: 16px;
        padding: 12px 12px;
        color: rgba(11,27,52,.78);
        font-size: 14px;
        line-height: 1.45;
    }

    .pg-actions {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: flex-end;
    }

    .pg-link {
        text-decoration: none;
        font-weight: 950;
        color: #082042;
        background: var(--yellow);
        border: 1px solid rgba(255,193,7,.35);
        padding: 10px 12px;
        border-radius: 14px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

        .pg-link:hover {
            filter: brightness(1.02);
        }

    .empty {
        border: 1px dashed rgba(13,110,253,.30);
        background: rgba(13,110,253,.04);
        padding: 18px;
        border-radius: 18px;
        color: var(--muted);
    }

    .pg-outer-name {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
</style>

<div class="container pg-wrap">
    <div class="pg-head">
        <div>
            <h1 class="pg-title">Моите заявки</h1>
            <p class="pg-sub">История на подадените заявки и текущ статус.</p>
        </div>

        <a class="pg-btn" asp-action="Create">+ Нова заявка</a>
    </div>

    @if (Model == null || !Model.Any())
    {
        <div class="empty">
            Нямаш подадени заявки. Натисни <strong>Нова заявка</strong>, за да изпратиш първата.
        </div>
    }
    else
    {
        <div class="pg-list">
            @foreach (var item in Model)
            {
                var statusText = (item.Status ?? "").ToString();
                var s = statusText.ToLowerInvariant();

                // Опитваме се да хванем статусите и по текст (ако са enum -> ToString()).
                var statusClass =
                s.Contains("approve") || s.Contains("одобр") ? "pg-status--approved" :
                s.Contains("reject") || s.Contains("отхв") ? "pg-status--rejected" :
                "pg-status--new";

                <div class="pg-item">
                    <div class="pg-row">
                        <div class="pg-outer-name">
                            <h3 class="pg-name">@item.Title</h3>
                            <div class="pg-meta">
                                <span class="pg-pill">📍 @item.Location</span>
                                <span class="pg-pill">🕒 @item.StartDateTime.ToString("dd.MM.yyyy HH:mm")</span>
                                <span class="pg-status @statusClass">🏷️ @item.Status</span>
                            </div>
                        </div>
                    </div>

                    <div class="pg-grid2">
                        <div class="pg-kv">
                            <div class="pg-k">Създадена на</div>
                            <div class="pg-v">@item.CreatedAt.ToString("dd.MM.yyyy HH:mm")</div>
                        </div>

                        <div class="pg-kv">
                            <div class="pg-k">Организатор</div>
                            <div class="pg-v">@item.OrganizerName</div>
                        </div>
                    </div>

                    <div class="pg-kv">
                        <div class="pg-k">Бележка от администратор</div>
                        @if (string.IsNullOrWhiteSpace(item.AdminNote))
                        {
                            <div class="pg-v" style="color: rgba(11,27,52,.55); font-weight: 800;">-</div>
                        }
                        else
                        {
                            <div class="pg-note">@item.AdminNote</div>
                        }
                    </div>
                </div>
            }
        </div>
    }
</div>
